<div align="center">
  <img src="https://github.com/zhanghui-china/intro_myself/blob/main/images/shishen.jpg" width="600"/>
  <br /><br />
![GitHub Repo stars](https://img.shields.io/github/stars/zhanghui-china/intro_myself?style=social)
![license](https://img.shields.io/github/license/zhanghui-china/intro_myself.svg)
[![issue resolution](https://img.shields.io/github/issues-closed-raw/zhanghui-china/intro_myself)](https://github.com/zhanghui-china/intro_myself)
[![open issues](https://img.shields.io/github/issues-raw/zhanghui-china/intro_myself)](https://github.com/LZHgrla/xtuner-template/issues)



ğŸ” æ¢ç´¢æˆ‘ä»¬çš„æ¨¡å‹ï¼š
[![Static Badge](https://img.shields.io/badge/-gery?style=social&label=ğŸ¤–%20ModelScope)](https://www.modelscope.cn/models/zhanghuiATchina/zhangxiaobai_shishen2_full/summary)

</div>
</p>

## ä»‹ç»

æœ¬APPç”¨äºå‚åŠ  ã€ä¹¦ç”ŸÂ·æµ¦è¯­å¤§æ¨¡å‹å®æˆ˜è¥ã€‘çš„é¡¹ç›®å®æˆ˜ã€‚ç”¨äºå®ç°å’¨è¯¢èœè°±çš„å¯¹è¯ã€‚

æœ¬APPçš„åŸºæœ¬æ€æƒ³ï¼Œæ˜¯åŸºäºInternLMçš„å¯¹è¯æ¨¡å‹ï¼Œé‡‡ç”¨ XiaChuFang Recipe Corpus æä¾›çš„1,520,327ç§ä¸­å›½é£Ÿè°±è¿›è¡Œå¾®è°ƒï¼Œç”Ÿæˆé£Ÿè°±æ¨¡å‹ã€‚ æ¨¡å‹å­˜æ”¾åœ¨modelscopeä¸Šï¼Œåº”ç”¨éƒ¨ç½²åœ¨openxlabä¸Šã€‚ä¸ºæ­¤æ„Ÿè°¢é­”æ­ç¤¾åŒºæä¾›å…è´¹çš„æ¨¡å‹å­˜æ”¾ç©ºé—´ï¼Œæ„Ÿè°¢OpenXLabæä¾›åº”ç”¨éƒ¨ç½²ç¯å¢ƒåŠGPUèµ„æºã€‚

æœ¬APPå€Ÿç”¨äº†å¶åƒå‘¨æ˜Ÿæ˜Ÿã€Šé£Ÿç¥ã€‹çš„ç”µå½±æˆªå›¾ï¼Œä¸ç”¨äºå•†ä¸šç›®çš„ã€‚ä»…ä»…ç”±æ­¤è¡¨è¾¾å¯¹å‘¨æ˜Ÿæ˜Ÿçš„å°Šæ•¬ä¹‹æƒ…ã€‚

æœ¬APPæä¾›çš„å›ç­”ä»…ä¾›å‚è€ƒï¼Œä¸ä½œä¸ºæ­£å¼èœè°±çš„çœŸå®åˆ¶ä½œæ­¥éª¤ã€‚ç”±äºå¤§æ¨¡å‹çš„â€œå¹»è§‰â€ç‰¹æ€§ï¼Œå¾ˆå¯èƒ½æœ‰äº›é£Ÿè°±ä¼šç»™ç”¨æˆ·å¸¦æ¥å¿ƒç†æˆ–ç”Ÿç†ä¸Šçš„ä¸åˆ©å½±å“ï¼Œå¸Œæœ›ç”¨æˆ·ä»…è®¤ä¸ºè¿™æ˜¯å‘¨æ˜Ÿæ˜Ÿè¿œç¨‹æ•™è‚²å­¦é™¢å­¦å‘˜å¼ å°ç™½è·Ÿå¤§å®¶å¼€çš„ä¸€æ¬¡æ— å˜å¤´çš„ç©ç¬‘ï¼Œåˆ‡å‹¿ä¸Šçº²ä¸Šçº¿ã€‚



## æ›´æ–°è¯´æ˜

- [2024.1] åŸºäºäºŒä»£150ä¸‡èœè°±å¾®è°ƒçš„æ¨¡å‹å’ŒAPPå‘å¸ƒã€‚
- [2024.1] åŸºäºä¸€ä»£150ä¸‡èœè°±å¾®è°ƒçš„æ¨¡å‹å’ŒAPPå‘å¸ƒã€‚



## å¿«é€Ÿä¸Šæ‰‹



### å®‰è£…

1. å‡†å¤‡ Python è™šæ‹Ÿç¯å¢ƒï¼š

   ```bash
   conda create -n xtunernew python=3.10 -y
   conda activate xtunernew
   ```

2. å…‹éš†è¯¥ä»“åº“ï¼š

   ```shell
   git clone https://github.com/zhanghui-china/intro_myself.git
   cd ./intro_myself
   ```

3. å®‰è£…ä¾èµ–åº“ï¼š

   ```shell
   pip install -r requirements.txt
   ```



### è®­ç»ƒ

â€‹		æœ¬é¡¹ç›®ä¸€ä»£æ¨¡å‹ ä½¿ç”¨ xtuner0.1.9 è®­ç»ƒï¼Œåœ¨ internlm-chat-7b ä¸Šè¿›è¡Œå¾®è°ƒï¼Œ[æ¨¡å‹åœ°å€](https://www.modelscope.cn/models/zhanghuiATchina/zhangxiaobai_shishen_full/summary)

â€‹		äºŒä»£æ¨¡å‹ ä½¿ç”¨ xtuner0.1.13 è®­ç»ƒï¼Œåœ¨ internlm2-chat-7b ä¸Šè¿›è¡Œå¾®è°ƒï¼Œ[æ¨¡å‹åœ°å€](https://www.modelscope.cn/models/zhanghuiATchina/zhangxiaobai_shishen2_full/summary)

1. å¾®è°ƒæ–¹æ³•å¦‚ä¸‹

   ```shell
   xtuner train ${YOUR_CONFIG} --deepspeed deepspeed_zero2
   ```

   - `--deepspeed` è¡¨ç¤ºä½¿ç”¨ [DeepSpeed](https://github.com/microsoft/DeepSpeed) ğŸš€ æ¥ä¼˜åŒ–è®­ç»ƒè¿‡ç¨‹ã€‚XTuner å†…ç½®äº†å¤šç§ç­–ç•¥ï¼ŒåŒ…æ‹¬ ZeRO-1ã€ZeRO-2ã€ZeRO-3 ç­‰ã€‚å¦‚æœç”¨æˆ·æœŸæœ›å…³é—­æ­¤åŠŸèƒ½ï¼Œè¯·ç›´æ¥ç§»é™¤æ­¤å‚æ•°ã€‚

2. å°†ä¿å­˜çš„ `.pth` æ¨¡å‹ï¼ˆå¦‚æœä½¿ç”¨çš„DeepSpeedï¼Œåˆ™å°†ä¼šæ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼‰è½¬æ¢ä¸º LoRA æ¨¡å‹ï¼š

   ```shell
   export MKL_SERVICE_FORCE_INTEL=1
   xtuner convert pth_to_hf ${YOUR_CONFIG} ${PTH} ${LoRA_PATH}
   ```

   3.å°†LoRAåˆå¹¶å…¥ HuggingFace æ¨¡å‹ï¼š

```shell
xtuner convert merge ${PTH} ${LoRA_PATH} ${SAVE_PATH}
```



### å¯¹è¯

```shell
xtuner chat ${SAVE_PATH} [optional arguments]
```

å‚æ•°ï¼š

- `--prompt-template`: ä¸€ä»£æ¨¡å‹ä½¿ç”¨ internlm_chatï¼ŒäºŒä»£ä½¿ç”¨  internlm2_chatã€‚
- `--system`: æŒ‡å®šå¯¹è¯çš„ç³»ç»Ÿå­—æ®µã€‚
- `--bits {4,8,None}`: æŒ‡å®š LLM çš„æ¯”ç‰¹æ•°ã€‚é»˜è®¤ä¸º fp16ã€‚
- `--no-streamer`: æ˜¯å¦ç§»é™¤ streamerã€‚
- `--top`: å¯¹äºäºŒä»£æ¨¡å‹ï¼Œå»ºè®®ä¸º0.8ã€‚
- `--temperature`: å¯¹äºäºŒä»£æ¨¡å‹ï¼Œå»ºè®®ä¸º0.8ã€‚
- `--repetition-penalty`: å¯¹äºäºŒä»£æ¨¡å‹ï¼Œå»ºè®®ä¸º1.002ï¼Œå¯¹äºä¸€ä»£æ¨¡å‹å¯ä¸å¡«ã€‚
- æ›´å¤šä¿¡æ¯ï¼Œè¯·æ‰§è¡Œ `xtuner chat -h` æŸ¥çœ‹ã€‚



## æ¼”ç¤º

Demo è®¿é—®åœ°å€ï¼šhttps://openxlab.org.cn/apps/detail/zhanghui-china/nlp_shishen



## æ¨¡å‹

 

```shell
import torch
from modelscope import AutoTokenizer, AutoModelForCausalLM
from tools.transformers.interface import GenerationConfig, generate_interactive

model_name_or_path = "zhanghuiATchina/zhangxiaobai_shishen_full" #å¯¹äºäºŒä»£æ¨¡å‹æ”¹ä¸º zhangxiaobai_shishen2_full

tokenizer = AutoTokenizer.from_pretrained(model_name_or_path, trust_remote_code=True)
model = AutoModelForCausalLM.from_pretrained(model_name_or_path, trust_remote_code=True, torch_dtype=torch.bfloat16, device_map='auto')
model = model.eval()

messages = []
generation_config = GenerationConfig(max_length=max_length, top_p=0.8, temperature=0.8, repetition_penalty=1.002)


print("=============Welcome to ShiShen chatbot, type 'exit' to exit.=============")

response, history = model.chat(tokenizer, "ä½ å¥½", history=[])
print(response)
response, history = model.chat(tokenizer, "é…¸èœé±¼æ€ä¹ˆåš", history=history)
print(response)
```



## ä½œè€…

é¡¹ç›®ä½œè€…ï¼šå¼ å°ç™½ï¼Œå­—å¤§ç™½ï¼Œä¼˜è´¨å›å¤å®¶ã€‚æ–œæ é’å¹´ï¼Œç²¾åŠ›å……æ²›ã€‚ç®€ç§°é’¢ç­‹ã€‚ [åšå®¢åœ°å€](https://www.zhihu.com/people/zhanghui_china)



## å¼€æºè®¸å¯è¯

è¯¥é¡¹ç›®é‡‡ç”¨ [Apache License 2.0 å¼€æºè®¸å¯è¯](LICENSE)ã€‚
